#!/usr/bin/env python3
"""
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∞–π—Ç–∞ 100200.ru
–ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
"""

import requests
import urllib.parse
import re
import time
import json
from urllib.robotparser import RobotFileParser
from concurrent.futures import ThreadPoolExecutor, as_completed
import argparse
import sys
from pathlib import Path

class VulnerabilityScanner:
    def __init__(self, base_url, delay=1):
        self.base_url = base_url.rstrip('/')
        self.delay = delay
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
        self.results = {
            'directory_listing': [],
            'path_traversal': [],
            'admin_panels': [],
            'sensitive_files': [],
            'template_files': [],
            'errors': []
        }
        
    def log(self, message, level="INFO"):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏"""
        timestamp = time.strftime("%H:%M:%S")
        print(f"[{timestamp}] {level}: {message}")
        
    def make_request(self, url, method='GET', **kwargs):
        """–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
        try:
            time.sleep(self.delay)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
            response = self.session.request(method, url, timeout=10, **kwargs)
            return response
        except requests.exceptions.RequestException as e:
            self.log(f"–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ {url}: {e}", "ERROR")
            return None
            
    def check_directory_listing(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å directory listing"""
        self.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ directory listing...")
        
        # –û–±—â–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        directories = [
            '/admin/', '/wp-admin/', '/administrator/', '/phpmyadmin/',
            '/backup/', '/backups/', '/config/', '/includes/',
            '/templates/', '/themes/', '/uploads/', '/files/',
            '/images/', '/css/', '/js/', '/assets/',
            '/logs/', '/tmp/', '/temp/', '/cache/',
            '/.git/', '/.svn/', '/.env/', '/.htaccess'
        ]
        
        for directory in directories:
            url = self.base_url + directory
            response = self.make_request(url)
            
            if response and response.status_code == 200:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ directory listing
                if any(indicator in response.text.lower() for indicator in [
                    'index of', 'parent directory', 'directory listing',
                    '[dir]', '[file]', 'name</th>', 'last modified'
                ]):
                    self.results['directory_listing'].append({
                        'url': url,
                        'status_code': response.status_code,
                        'content_length': len(response.text)
                    })
                    self.log(f"–ù–∞–π–¥–µ–Ω directory listing: {url}", "WARNING")
                    
    def check_path_traversal(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ path traversal —É—è–∑–≤–∏–º–æ—Å—Ç–∏"""
        self.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ path traversal...")
        
        # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è path traversal
        traversal_patterns = [
            '../../../etc/passwd',
            '..\\..\\..\\windows\\system32\\drivers\\etc\\hosts',
            '....//....//....//etc/passwd',
            '%2e%2e%2f%2e%2e%2f%2e%2e%2fetc%2fpasswd',
            '..%252f..%252f..%252fetc%252fpasswd'
        ]
        
        # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        test_params = ['file', 'path', 'page', 'include', 'template', 'view']
        
        for param in test_params:
            for pattern in traversal_patterns:
                url = f"{self.base_url}/?{param}={pattern}"
                response = self.make_request(url)
                
                if response and response.status_code == 200:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ —É—Å–ø–µ—à–Ω–æ–≥–æ path traversal
                    if any(indicator in response.text.lower() for indicator in [
                        'root:x:', 'bin/bash', 'localhost', '127.0.0.1',
                        'windows', 'system32', 'drivers'
                    ]):
                        self.results['path_traversal'].append({
                            'url': url,
                            'pattern': pattern,
                            'status_code': response.status_code
                        })
                        self.log(f"–í–æ–∑–º–æ–∂–Ω—ã–π path traversal: {url}", "WARNING")
                        
    def find_admin_panels(self):
        """–ü–æ–∏—Å–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π"""
        self.log("–ü–æ–∏—Å–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π...")
        
        admin_paths = [
            '/admin', '/wp-admin', '/administrator', '/phpmyadmin',
            '/admin.php', '/login.php', '/admin/login', '/dashboard',
            '/control', '/manage', '/panel', '/cpanel', '/webmail',
            '/admin/index.php', '/admin/login.php', '/admin/dashboard.php'
        ]
        
        for path in admin_paths:
            url = self.base_url + path
            response = self.make_request(url)
            
            if response and response.status_code in [200, 401, 403]:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–∑–Ω–∞–∫–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
                if any(indicator in response.text.lower() for indicator in [
                    'login', 'password', 'username', 'admin', 'dashboard',
                    'control panel', 'administration', 'wp-login'
                ]):
                    self.results['admin_panels'].append({
                        'url': url,
                        'status_code': response.status_code,
                        'title': self.extract_title(response.text)
                    })
                    self.log(f"–ù–∞–π–¥–µ–Ω–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: {url}", "INFO")
                    
    def find_sensitive_files(self):
        """–ü–æ–∏—Å–∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"""
        self.log("–ü–æ–∏—Å–∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤...")
        
        sensitive_files = [
            '/.env', '/.htaccess', '/.htpasswd', '/web.config',
            '/robots.txt', '/sitemap.xml', '/crossdomain.xml',
            '/phpinfo.php', '/info.php', '/test.php', '/config.php',
            '/database.php', '/db.php', '/settings.php', '/config.ini',
            '/.git/config', '/.svn/entries', '/composer.json',
            '/package.json', '/yarn.lock', '/package-lock.json'
        ]
        
        for file_path in sensitive_files:
            url = self.base_url + file_path
            response = self.make_request(url)
            
            if response and response.status_code == 200:
                self.results['sensitive_files'].append({
                    'url': url,
                    'status_code': response.status_code,
                    'content_length': len(response.text),
                    'content_preview': response.text[:200] + '...' if len(response.text) > 200 else response.text
                })
                self.log(f"–ù–∞–π–¥–µ–Ω —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª: {url}", "WARNING")
                
    def find_template_files(self):
        """–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤"""
        self.log("–ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤...")
        
        template_extensions = ['.php', '.html', '.htm', '.tpl', '.twig', '.blade.php']
        template_dirs = ['/templates/', '/themes/', '/views/', '/layouts/', '/includes/']
        
        for directory in template_dirs:
            url = self.base_url + directory
            response = self.make_request(url)
            
            if response and response.status_code == 200:
                # –ò—â–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã —à–∞–±–ª–æ–Ω–æ–≤
                template_links = re.findall(r'href=["\']([^"\']*\.(?:php|html|htm|tpl|twig))["\']', response.text, re.IGNORECASE)
                
                for link in template_links:
                    template_url = urllib.parse.urljoin(url, link)
                    template_response = self.make_request(template_url)
                    
                    if template_response and template_response.status_code == 200:
                        self.results['template_files'].append({
                            'url': template_url,
                            'status_code': template_response.status_code,
                            'content_length': len(template_response.text),
                            'file_type': Path(link).suffix
                        })
                        self.log(f"–ù–∞–π–¥–µ–Ω —Ñ–∞–π–ª —à–∞–±–ª–æ–Ω–∞: {template_url}", "INFO")
                        
    def extract_title(self, html_content):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"""
        title_match = re.search(r'<title[^>]*>(.*?)</title>', html_content, re.IGNORECASE | re.DOTALL)
        return title_match.group(1).strip() if title_match else "No title"
        
    def check_robots_txt(self):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ robots.txt"""
        self.log("–ü—Ä–æ–≤–µ—Ä–∫–∞ robots.txt...")
        
        robots_url = self.base_url + '/robots.txt'
        response = self.make_request(robots_url)
        
        if response and response.status_code == 200:
            self.log("robots.txt –Ω–∞–π–¥–µ–Ω", "INFO")
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—É—Ç–∏ –∏–∑ robots.txt
            disallowed_paths = re.findall(r'Disallow:\s*(.+)', response.text)
            for path in disallowed_paths:
                self.log(f"Disallowed path: {path.strip()}", "INFO")
                
    def run_full_scan(self):
        """–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
        self.log(f"–ù–∞—á–∏–Ω–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ {self.base_url}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º robots.txt –ø–µ—Ä–≤—ã–º
        self.check_robots_txt()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        checks = [
            self.check_directory_listing,
            self.check_path_traversal,
            self.find_admin_panels,
            self.find_sensitive_files,
            self.find_template_files
        ]
        
        for check in checks:
            try:
                check()
            except Exception as e:
                self.log(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ {check.__name__}: {e}", "ERROR")
                self.results['errors'].append(f"{check.__name__}: {e}")
                
    def save_results(self, filename='scan_results.json'):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"""
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(self.results, f, ensure_ascii=False, indent=2)
        self.log(f"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {filename}")
        
    def print_summary(self):
        """–í—ã–≤–æ–¥ —Å–≤–æ–¥–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        print("\n" + "="*60)
        print("–°–í–û–î–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –°–ö–ê–ù–ò–†–û–í–ê–ù–ò–Ø")
        print("="*60)
        
        print(f"Directory Listing: {len(self.results['directory_listing'])} –Ω–∞–π–¥–µ–Ω–æ")
        print(f"Path Traversal: {len(self.results['path_traversal'])} –Ω–∞–π–¥–µ–Ω–æ")
        print(f"Admin Panels: {len(self.results['admin_panels'])} –Ω–∞–π–¥–µ–Ω–æ")
        print(f"Sensitive Files: {len(self.results['sensitive_files'])} –Ω–∞–π–¥–µ–Ω–æ")
        print(f"Template Files: {len(self.results['template_files'])} –Ω–∞–π–¥–µ–Ω–æ")
        print(f"Errors: {len(self.results['errors'])} –æ—à–∏–±–æ–∫")
        
        if self.results['errors']:
            print("\n–û–®–ò–ë–ö–ò:")
            for error in self.results['errors']:
                print(f"  - {error}")

def main():
    parser = argparse.ArgumentParser(description='–°–∫–∞–Ω–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Å–∞–π—Ç–∞ 100200.ru')
    parser.add_argument('--url', default='https://100200.ru', help='URL –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è')
    parser.add_argument('--delay', type=float, default=1.0, help='–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫)')
    parser.add_argument('--output', default='scan_results.json', help='–§–∞–π–ª –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤')
    
    args = parser.parse_args()
    
    print("üîç –°–∫–∞–Ω–µ—Ä —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Å–∞–π—Ç–∞ 100200.ru")
    print("‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö!")
    print(f"üéØ –¶–µ–ª—å: {args.url}")
    print(f"‚è±Ô∏è  –ó–∞–¥–µ—Ä–∂–∫–∞: {args.delay} —Å–µ–∫")
    print("-" * 60)
    
    scanner = VulnerabilityScanner(args.url, args.delay)
    
    try:
        scanner.run_full_scan()
        scanner.print_summary()
        scanner.save_results(args.output)
        
    except KeyboardInterrupt:
        print("\n‚ùå –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        scanner.save_results(args.output)
    except Exception as e:
        print(f"\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        scanner.save_results(args.output)

if __name__ == "__main__":
    main()
